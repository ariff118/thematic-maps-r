---
title: "Reading data"
output: 
    html_document:
      number_sections: yes
      toc: yes
      toc_float: yes
---


```{r, message=FALSE, warning=FALSE}
# load general packages used below
library(ggplot2)
library(sf)
library(dplyr)
library(ggplot2)
library(tmap)
```

Need to have two sources of data:
* Reading in data to display
* Reading in spatial data ('spaces to color in') ...
    - ... from downloaded files.
    - ... through R-packages.

# Reading in data to display

Depends on format your data is in, three robust R-packages should cover most: 

* readr: 
* readxl:
* haven:

Most important point: have a variable/column that contains the appropriate spatial identifier. E.g. NIS-code, NUTS-code, etc.

```{r}
# read in employment/unemployment numbers

# CSV

# XLSX

# SAS

```

```{r}

```


# Reading downloaded spatial data 

Formats: Shapefiles, GeoJSON, KML, etc.

Recommended: 

* Use `readOGR()` in the rgdal-package: hard to find a format not covered.
* Convert to simple features-object using 

```{r}
library(rgdal)
#readOGR()
```


# Reading in spatial data through R-packages




## Spatial data in R-packages

### Belgium

Open spatial data on administrative boundaries: 

* Statistical sectors
* Munci
* 

Identifiers: NIS-codes!

```{r}
library(BelgiumMaps.StatBel)
data("BE_ADMIN_PROVINCE") # load spatial object for provincial level
provinces <- st_as_sf(BE_ADMIN_PROVINCE) # convert to sf-object
qtm(provinces) # plot with tmap
```




```{r}

```


## Europe

Spatial identifier: NUTS-code?

```{r, message=FALSE, warning=FALSE}
library(eurostat)
eu_nuts0 <- get_eurostat_geospatial(
  resolution = "60", # detail 
  nuts_level = "0") # NUTS 0-3

eu_nuts2 <- get_eurostat_geospatial(
  resolution = "60", # detail 
  nuts_level = "2") # NUTS 0-3
```



```{r}
qtm(eu_nuts0)
```

```{r}
qtm(eu_nuts2)
```


```{r, message=FALSE, warning=FALSE}
ggplot(eu_nuts0) +
  geom_sf() +
  coord_sf(
    # limit map to 'mainland' EU
    xlim = c(2500000, 6000000), ylim =c(1500000, 5300000),
    crs = 3035)
```

```{r, message=FALSE, warning=FALSE}
ggplot(eu_nuts2) +
  geom_sf() +
  coord_sf(xlim = c(2500000, 6000000), 
           ylim =c(1500000, 5300000), crs = 3035)
```

## World


```{r, message=FALSE, warning=FALSE}
library("rworldmap")
world <- getMap(resolution = "low") # for high load ?
world <- st_as_sf(world)
```

```{r, message=FALSE, warning=FALSE}
qtm(world)
```

```{r}
# data("World")
# qtm(World %>% filter(continent == 'Europe', name != 'Russia'))
# qtm(World %>% filter(name %in% c('Belgium', 'Netherlands', 'Luxembourg')))
```




# Get rid of too much spatial data

Options:

* Filter or select (un)wanted spatial data. 
* Crop the map to the required area.
* Keep the data, limit the visible map area.

```{r}
ggplot(world) +
  geom_sf() +  
  coord_sf(xlim = c(2500000, 6000000), 
           ylim =c(1500000, 5300000), crs = 3035)
```

```{r, message=FALSE, warning=FALSE}
m.latam <- world %>% 
  filter(GEO3 == 'South America')

ggplot(m.latam) +
  geom_sf()
```


```{r, message=FALSE, warning=FALSE}
m.benelux <- world %>%
  filter(NAME %in% c('Belgium', 'Netherlands', 'Luxembourg'))

ggplot(m.benelux) + 
  geom_sf() +  
  coord_sf(xlim = c(3700000, 4300000), 
           ylim =c(2800000, 3500000), crs = 3035)
```


```{r, message=FALSE, warning=FALSE}
eu.mainland <- st_crop(eu_nuts2, c(xmin=-10, xmax=45, ymin=36, ymax=71))
qtm(eu.mainland)
```

```{r}
ggplot(eu.mainland) +
  geom_sf() +  
  coord_sf(xlim = c(2500000, 6000000), 
           ylim =c(1500000, 5300000), crs = 3035)  
```



## API


```{r}
#library(rgdal)
#library(sf)
#readOGR('https://opendata.brussel.be/explore/dataset/bruxelles_distributeurs_bancaires/download/?format=geojson') %>%
  
```

